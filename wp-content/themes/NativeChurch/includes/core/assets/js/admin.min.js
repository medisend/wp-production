/*global jQuery, document, imic_opts, confirm, relid:true, console, jsonView */function verify_fold(e){jQuery(document).ready(function(t){if(e.hasClass("imic-info")||e.hasClass("imic-typography"))return;var n=e.parents(".imic-field:first").data("id"),r=e.val();if(imic_opts.folds[n]&&imic_opts.folds[n].children){var i={};t.each(imic_opts.folds[n].children,function(e,s){t.each(s,function(t,s){i[s]||(i[s]={show:!1,hidden:!1});if(e==r||i[s]===!0)i[s].show=!0;i[s].show===!0&&jQuery("#"+n).parents("tr:first").hasClass("hiddenFold")&&(i[s].show=!1);i[s].show===!0&&jQuery("#"+imic_opts.folds[n].parent).hasClass("hiddenFold")&&(i[s].show=!1);i[s].hidden=jQuery("#"+s).parents("tr:first").hasClass("hiddenFold")})});t.each(i,function(e){var t=jQuery("#"+e).parents("tr:first");i[e].show===!0?t.fadeIn("medium",function(){t.removeClass("hiddenFold");imic_opts.folds[e]&&imic_opts.folds[e].children}):i[e].hidden===!1&&t.fadeOut("medium",function(){t.addClass("hiddenFold");imic_opts.folds[e].children})})}})}function imic_change(e){jQuery("body").trigger("check_dependencies",e);e.hasClass("compiler")&&jQuery("#imic-compiler-hook").val(1);e.hasClass("foldParent");window.onbeforeunload=confirmOnPageExit;if(jQuery(e).parents("fieldset.imic-field:first").hasClass("imic-field-error")){jQuery(e).parents("fieldset.imic-field:first").removeClass("imic-field-error");jQuery(e).parent().find(".imic-th-error").slideUp();var t=jQuery(e).closest(".imic-group-tab").attr("id"),n=!0;jQuery("#"+t+" .imic-field-error").each(function(){n=!1});if(n){jQuery("#"+t+"_li .imic-menu-error").hide();jQuery("#"+t+"_li .imic-group-tab-link-a").removeClass("hasError")}}jQuery("#imic-save-warn").slideDown()}(function(e){"use strict";e.imic=e.imic||{};var t=e("body");e(document).ready(function(){jQuery.fn.isOnScreen=function(){if(!window)return;var e=jQuery(window),t={top:e.scrollTop(),left:e.scrollLeft()};t.right=t.left+e.width();t.bottom=t.top+e.height();var n=this.offset();n.right=n.left+this.outerWidth();n.bottom=n.top+this.outerHeight();return!(t.right<n.left||t.left>n.right||t.bottom<n.top||t.top>n.bottom)};e.imic.required();t.on("check_dependencies",function(t,n){e.imic.check_dependencies(t,n)})});e.imic.required=function(){e(".hiddenFold , .showFold").each(function(){var t=e(this),n=t.parents("tr:eq(0)"),r=t.data();if(t.hasClass("hiddenFold")){n.addClass("hiddenFold").attr("data-check-field",r.checkField).attr("data-check-comparison",r.checkComparison).attr("data-check-value",r.checkValue).attr("data-check-id",r.id).hide();t.removeClass("hiddenFold").removeAttr("data-check-field").removeAttr("data-check-comparison").removeAttr("data-check-value")}else{n.attr("data-check-field",r.checkField).attr("data-check-comparison",r.checkComparison).attr("data-check-value",r.checkValue).attr("data-check-id",r.id);t.removeClass("showFold").removeAttr("data-check-field").removeAttr("data-check-comparison").removeAttr("data-check-value")}});e(".fold").promise().done(function(){e(".foldParent").each(function(){if(e(this).attr("type")=="radio"&&e(this).attr("checked")!="checked")return;var t=e(this).parents(".imic-field:first").data("id");imic_opts.folds[t]&&(imic_opts.folds[t].parent||e.imic.verify_fold(e(this)))})});t.on("change","#imic-main select, #imic-main radio, #imic-main input[type=checkbox], #imic-main input[type=hidden]",function(t){e.imic.check_dependencies(t,this)})};e.imic.check_dependencies=function(n,r){var i=e(r),s=i.parents(".imic-group-tab:eq(0)");s.length||(s=t);e(r).prop("type")=="checkbox"&&(e(r).is(":checked")?e(r).val("1"):e(r).val("0"));var o=i.parents(".imic-field:first").data("id"),u=s.find('tr[data-check-field="'+o+'"]'),a=r.value,f=i.parents("tr:eq(0)").is(".hiddenFold");if(!u.length)return;u.each(function(){var t=e(this),n=t.data(),i=n.checkValue,s=!1;if(!f)switch(n.checkComparison){case"=":case"equals":if(i.toString().indexOf("|")!==-1){var o=i.split("|");e.inArray(a,o)!=-1&&(s=!0)}else a==i&&(s=!0);break;case"!=":case"not":if(i.indexOf("|")!==-1){var o=i.split("|");e.inArray(a,o)==-1&&(s=!0)}else a!=i&&(s=!0);break;case">":case"greater":case"is_larger":parseFloat(a)>parseFloat(i)&&(s=!0);break;case"<":case"less":case"is_smaller":parseFloat(a)<parseFloat(i)&&(s=!0);break;case"contains":a.indexOf(i)!=-1&&(s=!0);break;case"doesnt_contain":a.indexOf(i)==-1&&(s=!0);break;case"is_empty_or":if(a==""||a==i)s=!0;break;case"not_empty_and":a!=""&&a!=i&&(s=!0)}e.imic.verify_fold(e(r))})};e.imic.verify_fold=function(t){var n=t.parents(".imic-field:first").data("id"),r=t.val(),i=t.parents(".imic-groups-accordion-group:first").length>0?t.parents(".imic-groups-accordion-group:first"):t.parents(".imic-group-tab:eq(0)");if(imic_opts.folds[n]&&imic_opts.folds[n].children){var s={};e.each(imic_opts.folds[n].children,function(t,o){e.each(o,function(e,o){s[o]||(s[o]={show:!1,hidden:!1});if(t==r||s[o]===!0)s[o].show=!0;s[o].show===!0&&i.find('tr[data-check-id="'+n+'"]').hasClass("hiddenFold")&&(s[o].show=!1);s[o].show===!0&&i.find('tr[data-check-id="'+imic_opts.folds[n].parent+'"]').hasClass("hiddenFold")&&(s[o].show=!1);s[o].hidden=i.find('tr[data-check-id="'+o+'"]').hasClass("hiddenFold")})});e.each(s,function(t){var n=i.find('tr[data-check-id="'+t+'"]');s[t].show===!0?n.fadeIn("medium",function(){n.removeClass("hiddenFold");imic_opts.folds[t]&&imic_opts.folds[t].children&&e.imic.verify_fold(n.find("select, radio, input[type=checkbox], input[type=hidden]"))}):s[t].hidden===!1&&n.fadeOut("medium",function(){n.addClass("hiddenFold");imic_opts.folds[t].children&&e.imic.verify_fold(n.find("select, radio, input[type=checkbox], input[type=hidden]"))})})}}})(jQuery);jQuery.noConflict();var confirmOnPageExit=function(e){e=e||window.event;var t=imic_opts.save_pending;e&&(e.returnValue=t);window.onbeforeunload=null;return t};jQuery(document).ready(function(e){function t(e){return decodeURI(((new RegExp(e+"="+"(.+?)(&|$)")).exec(location.search)||[,""])[1])}function s(){var e=jQuery("#info_bar").width()-2;if(!jQuery("#info_bar").isOnScreen()&&!jQuery("#imic-footer-sticky").isOnScreen()){jQuery("#imic-footer").css({position:"fixed",bottom:"0",width:e});jQuery("#imic-footer").addClass("sticky-footer-fixed");jQuery("#imic-sticky-padder").show()}else{jQuery("#imic-footer").css({background:"#eee",position:"inherit",bottom:"inherit",width:"inherit"});jQuery("#imic-sticky-padder").hide();jQuery("#imic-footer").removeClass("sticky-footer-fixed")}}jQuery(".imic-action_bar, .imic-presets-bar").on("click",function(){window.onbeforeunload=null});jQuery().tipsy&&e(".tips").tipsy({fade:!0,gravity:"s",opacity:.7});e("#toplevel_page_"+imic_opts.slug+" .wp-submenu a").click(function(t){t.preventDefault();var n=e(this).attr("href").split("&tab=");e("#"+n[1]+"_section_group_li_a").click();console.log(n[1]);return!1});jQuery(".imic-group-tab-link-a").click(function(){relid=jQuery(this).data("rel");e.cookie("imic_current_tab",relid,{expires:7,path:"/"});e("#toplevel_page_"+imic_opts.slug+" .wp-submenu a.current").removeClass("current");e("#toplevel_page_"+imic_opts.slug+" .wp-submenu li.current").removeClass("current");e("#toplevel_page_"+imic_opts.slug+" .wp-submenu a").each(function(){var t=e(this).attr("href").split("&tab=");if(t[1]==relid){e(this).addClass("current");e(this).parent().addClass("current")}});var t=jQuery(".imic-group-tab-link-li.active .imic-group-tab-link-a").data("rel");jQuery("#"+t+"_section_group_li").removeClass("active");jQuery("#"+t+"_section_group").hide();jQuery("#"+relid+"_section_group").fadeIn(300,function(){s()});jQuery("#"+relid+"_section_group_li").addClass("active")});var n=t("tab");if(n!==""){if(e.cookie("imic_current_tab_get")!==n){e.cookie("imic_current_tab",n,{expires:7,path:"/"});e.cookie("imic_current_tab_get",n,{expires:7,path:"/"});jQuery("#"+n+"_section_group_li").click()}}else e.cookie("imic_current_tab_get")!==""&&e.removeCookie("imic_current_tab_get");var r=jQuery("#"+e.cookie("imic_current_tab")+"_section_group_li_a");e.cookie("imic_current_tab")===null||typeof e.cookie("imic_current_tab")=="undefined"||r.length===0?jQuery(".imic-group-tab-link-a:first").click():r.click();jQuery('input[name="'+imic_opts.opt_name+'[defaults]"]').click(function(){if(!confirm(imic_opts.reset_confirm))return!1;window.onbeforeunload=null});jQuery("#expand_options").click(function(e){e.preventDefault();var t=jQuery("#expand_options"),n=jQuery("#imic-sidebar").width(),r=jQuery("#imic-group-menu .active a").data("rel")+"_section_group";if(t.hasClass("expanded")){t.removeClass("expanded");jQuery("#imic-main").removeClass("expand");jQuery("#imic-sidebar").stop().animate({"margin-left":"0px"},500);jQuery("#imic-main").stop().animate({"margin-left":n},500);jQuery(".imic-group-tab").each(function(){jQuery(this).attr("id")!==r&&jQuery(this).fadeOut("fast")})}else{t.addClass("expanded");jQuery("#imic-main").addClass("expand");jQuery("#imic-sidebar").stop().animate({"margin-left":-n-2},500);jQuery("#imic-main").stop().animate({"margin-left":"0px"},500);jQuery(".imic-group-tab").fadeIn()}return!1});jQuery("#imic-import").click(function(e){if(jQuery("#import-code-value").val()===""&&jQuery("#import-link-value").val()===""){e.preventDefault();return!1}});jQuery("#imic-save").is(":visible")&&jQuery("#imic-save").slideDown();jQuery("#imic-imported").is(":visible")&&jQuery("#imic-imported").slideDown();jQuery(document.body).on("change","input, textarea, select",function(){jQuery(this).hasClass("noUpdate")||imic_change(jQuery(this))});jQuery("#imic-import-code-button").click(function(){if(jQuery("#imic-import-link-wrapper").is(":visible")){jQuery("#imic-import-link-wrapper").fadeOut("fast");jQuery("#import-link-value").val("")}jQuery("#imic-import-code-wrapper").fadeIn("slow")});jQuery("#imic-import-link-button").click(function(){if(jQuery("#imic-import-code-wrapper").is(":visible")){jQuery("#imic-import-code-wrapper").fadeOut("fast");jQuery("#import-code-value").val("")}jQuery("#imic-import-link-wrapper").fadeIn("slow")});jQuery("#imic-export-code-copy").click(function(){jQuery("#imic-export-link-value").is(":visible")&&jQuery("#imic-export-link-value").fadeOut("slow");jQuery("#imic-export-code").toggle("fade")});jQuery("#imic-export-link").click(function(){jQuery("#imic-export-code").is(":visible")&&jQuery("#imic-export-code").fadeOut("slow");jQuery("#imic-export-link-value").toggle("fade")});var i=jQuery("#imic-footer").height();jQuery("#imic-sticky-padder").css({height:i});jQuery(window).scroll(function(){s()});jQuery(window).resize(function(){s()});jQuery("#imic-save, #imic-imported").delay(4e3).slideUp();jQuery("#imic-field-errors").delay(8e3).slideUp();jQuery(".imic-save").click(function(){window.onbeforeunload=null});e("#consolePrintObject").on("click",function(){console.log(jQuery.parseJSON(jQuery("#imic-object-json").html()))});typeof jsonView=="function"&&jsonView("#imic-object-json","#imic-object-browser");if(imic_opts.errors!==undefined){jQuery("#imic-field-errors span").html(imic_opts.errors.total);jQuery("#imic-field-errors").show();jQuery.each(imic_opts.errors.errors,function(e,t){jQuery("#"+e+"_section_group_li_a").prepend('<span class="imic-menu-error">'+t.total+"</span>");jQuery("#"+e+"_section_group_li_a").addClass("hasError");jQuery.each(t.errors,function(e,t){console.log(t);jQuery("#"+imic_opts.opt_name+"-"+t.id).addClass("imic-field-error");jQuery("#"+imic_opts.opt_name+"-"+t.id).append('<div class="imic-th-error">'+t.msg+"</div>")})})}if(imic_opts.warnings!==undefined){jQuery("#imic-field-warnings span").html(imic_opts.warnings.total);jQuery("#imic-field-warnings").show();jQuery.each(imic_opts.warnings.warnings,function(e,t){jQuery("#"+e+"_section_group_li_a").prepend('<span class="imic-menu-warning">'+t.total+"</span>");jQuery("#"+e+"_section_group_li_a").addClass("hasWarning");jQuery.each(t.warnings,function(e,t){jQuery("#"+imic_opts.opt_name+"-"+t.id).addClass("imic-field-warning");jQuery("#"+imic_opts.opt_name+"-"+t.id).append('<div class="imic-th-warning">'+t.msg+"</div>")})})}jQuery(".imic-section-tabs div").hide();jQuery(".imic-section-tabs div:first").show();jQuery(".imic-section-tabs ul li:first").addClass("active");jQuery(".imic-section-tabs ul li a").click(function(){jQuery(".imic-section-tabs ul li").removeClass("active");jQuery(this).parent().addClass("active");var t=e(this).attr("href");jQuery(".imic-section-tabs div").hide();jQuery(t).fadeIn();return!1})});